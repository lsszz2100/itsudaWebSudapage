<?xml version="1.0" encoding ="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace ="itsuda.notice">


	<select id ="getTime" resultType="string">
		SELECT SYSDATE()
	</select>

	<select id ="getListBoard" resultType="com.itsuda.notice.vo.NoticeVO">
	<![CDATA[
	SELECT 
					    @rownum:=@rownum+1 No,
					    BOARD_NO,
					    BOARD_TITLE,
					    BOARD_CONTENT,
					    DATE_FORMAT(BOARD_INSERTD, '%Y-%m-%d') AS BOARD_INSERTD,
					    BOARD_MODIFYD,
					    BOARD_VIEWCNT,
					    BOARD_WRITER,
					    BORAD_DELFLAG,
					    BOARD_VIEWCNT
    FROM 				
    					TB_BOARD,
    					(SELECT @rownum:=0) r
    WHERE 				BORAD_DELFLAG = 'N'
    ]]>
    <include refid="search"/>
     <![CDATA[
    ORDER BY BOARD_NO DESC, BOARD_INSERTD DESC,No
    LIMIT #{pageStart}, #{perPageNum}
     ]]>
	</select>
	
	
	<insert id="insertBoard" parameterType="com.itsuda.notice.vo.NoticeVO">
	INSERT INTO 		
						TB_BOARD(BOARD_WRITER , BOARD_TITLE ,BOARD_CONTENT )
	VALUES				
						(#{boardWriter} , #{boardTitle} , #{boardContent})
	</insert >
	
	
	<select id="getOneBoard" parameterType="java.lang.Integer" resultType="com.itsuda.notice.vo.NoticeVO">
	 select  
						@rownum:=@rownum+1 No,
					    BOARD_NO,
					    BOARD_TITLE,
					    BOARD_CONTENT,
					    DATE_FORMAT(BOARD_INSERTD, '%Y-%m-%d') AS BOARD_INSERTD,
					   	DATE_FORMAT(BOARD_MODIFYD, '%Y-%m-%d') AS BOARD_MODIFYD,
					    BOARD_VIEWCNT,
					    BOARD_WRITER,
					    BORAD_DELFLAG,
					    BOARD_VIEWCNT
	from 
						TB_BOARD
	where 				
						BOARD_NO = #{boardNo}
	</select>
	
	<update id="deleteBoard" parameterType="java.lang.Integer">
	UPDATE 				
						TB_BOARD 
	SET 
						BORAD_DELFLAG = 'Y' 
	WHERE 				
						BOARD_NO=#{boardNo}
	</update>
	
	
	
	<update id="modifyBoard" parameterType="com.itsuda.notice.vo.NoticeVO">

	UPDATE 					
							TB_BOARD 
	SET 
							BOARD_TITLE = #{boardTitle},  
							BOARD_CONTENT = #{boardContent} , 
							BOARD_MODIFYD =  NOW()
	WHERE 
							BOARD_NO=#{boardNo}
	</update>
	
	
	<select id="countBorad" resultType="java.lang.Integer">
	   <![CDATA[
	 SELECT 
	  					count(BOARD_NO) 
     FROM 
      					TB_BOARD
     WHERE 
	  					BOARD_NO > 0
     AND 
	  					BORAD_DELFLAG = 'N'
	  ]]>
        <include refid="search"/>
	</select>
	
	<select id="selectBoard" resultType="com.itsuda.notice.vo.NoticeVO">
	 SELECT 
	 					@rownum:=@rownum+1 No
	 FROM 
	 					TB_BOARD,
	 					(SELECT @rownum:=0) r
	 WHERE
	 					BOARD_DELFLAG = 'N'
	</select>
	
	<sql id="search">
		 AND (
 		   BOARD_TITLE LIKE CONCAT('%', #{keyword}, '%')
 		   OR BOARD_CONTENT LIKE CONCAT('%', #{keyword}, '%')
 		   OR BOARD_WRITER LIKE CONCAT('%', #{keyword}, '%')
 		   )
    </sql>
	
	
	
</mapper>